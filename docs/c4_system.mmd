graph TD
    %% C4 System Context - wording
    User((Person: DevOps Engineer))
    PublicUser((Person: Public End User))

    subgraph External_Systems [External Systems]
        Git[External System: Git Hosting
        GitHub / GitLab]
        CI[External System: CI Pipeline
        GitHub Actions / GitLab CI]
        Registry[External System: Container Registry]
        DNS[External System: DNS and TLS Edge
        Cloudflare / Route53]
        Obj[(External System: Object Storage
        S3-Compatible
            Backups / Artifacts)]
    end

    subgraph System_Boundary [Software System: EC2 Single VPS
    K3s - Single Node]
        WG[Container: WireGuard VPN
        ISO 27001: A.9.2.1]
        API[Container: Kubernetes API
            6443]
        Argo[Container: Argo CD
        GitOps Sync
        ISO 27001: A.12.1.2]
        Ingress[Container: Traefik Ingress
            443
            ISO 27001: A.13.1.1]
        App[Container: Nginx Test App
            dev namespace]
        Blocky[Container: Blocky DNS
            Ad/Tracker Blocking]
        Obs[Container: Observability
            kube-prometheus-stack
            Loki / Tempo / Mimir / Promtail]
        Vault[(Container: HashiCorp Vault
            Host-level service)]
    end

    %% Dev + Delivery
    User -- "Pushes manifests & app code" --> Git
    Git -- "Triggers" --> CI
    CI -- "Build & push image" --> Registry
    Argo -- "Pulls desired state" --> Git

    %% Traffic
    PublicUser -- "HTTPS" --> DNS
    DNS -- "Routes" --> Ingress
    Ingress -- "Routes" --> App

    %% Admin / Private Control Plane
    User -- "VPN" --> WG
    WG -- "Private access" --> API
    WG -- "Private access" --> Argo

    %% Runtime dependencies
    App -- "Pull image" --> Registry
    App -- "Metrics/Logs/Traces" --> Obs
    Blocky -- "Metrics" --> Obs

    %% Backups - budget-friendly
    System_Boundary -- "Backups" --> Obj

    classDef external fill:#e8eaf6,stroke:#3949ab,color:#1a237e;
    classDef boundary fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c;
    classDef runtime fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20;
    classDef security fill:#fff3e0,stroke:#ef6c00,color:#e65100;

    class Git,CI,Registry,DNS,Obj external;
    class System_Boundary boundary;
    class App,Blocky,Obs runtime;
    class WG,API,Argo,Ingress,Vault security;
