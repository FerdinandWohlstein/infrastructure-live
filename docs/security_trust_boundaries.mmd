graph TB
    %% Trust boundaries - threat-model-lite

    subgraph Internet [Trust Boundary: Restricted Access]
        PublicUser((Restricted User))
    end

    subgraph DNS_Edge [Trust Boundary: External DNS and TLS Edge]
        DNS[External System: DNS and TLS Edge]
    end

    subgraph VPS [Trust Boundary: Single VPS]
        subgraph Edge [Edge]
            Ingress[Container: Traefik Ingress]
        end

        subgraph Private_Admin [Trust Boundary: Admin Network]
            WG[Container: WireGuard VPN]
            Admin((Admin User))
        end

        subgraph Cluster [Trust Boundary: K3s Cluster]
            API[Container: Kubernetes API]
            Argo[Container: Argo CD]
            App[Container: Nginx Test App]
            Blocky[Container: Blocky DNS]
            Obs[Container: Observability Stack]
        end

        subgraph Host_Level [Trust Boundary: Host-level Services]
            Vault[(Container: HashiCorp Vault)]
        end
    end

    PublicUser -->|HTTPS| DNS
    DNS -->|HTTPS| Ingress
    Ingress -->|Routes| App

    Admin -->|VPN| WG
    WG -->|Private access| API

    Argo -->|Applies desired state| Cluster
    App -->|Logs/metrics/traces| Obs
    Blocky -->|Logs/metrics| Obs

    classDef boundary fill:#f5f5f5,stroke:#616161,color:#212121;
    classDef edge fill:#fff3e0,stroke:#ef6c00,color:#e65100;
    classDef cluster fill:#e1f5fe,stroke:#01579b,color:#003b6f;
    classDef runtime fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20;

    class DNS_Edge,Private_Admin,Host_Level,Internet boundary;
    class Edge edge;
    class Cluster cluster;
    class App,Blocky,Obs runtime;
