apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  finalizers:
  - resources-finalizer.argocd.argoproj.io
  name: mimir
  namespace: argocd
spec:
  destination:
    namespace: observability
    server: https://kubernetes.default.svc
  project: default
  source:
    chart: mimir-distributed
    helm:
      releaseName: mimir
      values: |
        # Monolithic mode for single-node clusters
        mimir:
          structuredConfig:
            common:
              storage:
                backend: filesystem
                filesystem:
                  dir: /data/mimir
            blocks_storage:
              backend: filesystem
              filesystem:
                dir: /data/mimir/blocks
            alertmanager_storage:
              backend: filesystem
              filesystem:
                dir: /data/mimir/alertmanager
            ruler_storage:
              backend: filesystem
              filesystem:
                dir: /data/mimir/ruler
        # Minimal resources for small clusters
        ingester:
          replicas: 1
          persistentVolume:
            enabled: true
            size: 10Gi
        distributor:
          replicas: 1
        querier:
          replicas: 1
        query_frontend:
          replicas: 1
        compactor:
          replicas: 1
        store_gateway:
          replicas: 1
          persistentVolume:
            enabled: true
            size: 10Gi
        # Disable MinIO - using filesystem
        minio:
          enabled: false
    repoURL: https://grafana.github.io/helm-charts
    targetRevision: "6.1.0"
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - ServerSideApply=true
